<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    echo "<h3>ðŸ“¦ Submitted Values (clean numeric data):</h3>";
    echo "<pre>";
    print_r($_POST);
    echo "</pre><hr>";
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auto Convert Number Inputs with Thousand Separator</title>
<style>
body { font-family: Arial, sans-serif; margin: 40px; }
form { max-width: 600px; }
label { display: block; margin-top: 12px; }
input { width: 100%; padding: 8px; font-size: 16px; }
button { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>

<h2>ðŸ’¡ Auto Thousand Separator (Convert All Number Inputs to Text)</h2>
<p>This script automatically converts all <code>&lt;input type="number"&gt;</code> to text inputs,  
adds commas while typing, and removes them before form submit.</p>

<form method="POST">
    <label>Amount 1:</label>
    <input type="number" name="amount1" value="1000">

    <label>Amount 2:</label>
    <input type="number" name="amount2" value="25000.50">

    <label>Tax %:</label>
    <input type="number" name="tax" value="12.5">

    <label>Discount:</label>
    <input type="number" name="discount" value="1000000">

    <button type="submit">Submit</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {

    // --- Main function to apply formatting behavior ---
    function applyNumberFormatting(input) {
        // Skip if already processed
        if (input.dataset.formatted === "true") return;
        input.dataset.formatted = "true";

        // Convert <input type="number"> â†’ text (for commas)
        if (input.type === "number") {
            input.type = "tel";
            input.setAttribute("inputmode", "decimal"); // numeric keyboard on mobile
        }

        // Format initial value
        if (input.value) input.value = formatWithCommas(cleanValue(input.value));

        // On typing
        input.addEventListener("input", function () {
            let val = cleanValue(input.value);
            input.value = formatWithCommas(val);
        });
    }

    // --- Helper to clean unwanted chars ---
    function cleanValue(value) {
        // Remove anything except digits and one dot
        value = value.replace(/[^\d.]/g, "");
        // Keep only the first dot if multiple
        const parts = value.split(".");
        if (parts.length > 2) value = parts[0] + "." + parts.slice(1).join("");
        return value;
    }

    // --- Helper to format with commas ---
    function formatWithCommas(value) {
        if (!value) return "";
        const parts = value.split(".");
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return parts.join(".");
    }

    // --- Apply to existing inputs ---
    document.querySelectorAll('input[type="number"], input[inputmode="decimal"]').forEach(applyNumberFormatting);

    // --- Watch for dynamically added inputs (AJAX, etc.) ---
    const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
            mutation.addedNodes.forEach(node => {
                if (node.nodeType === 1) {
                    const newInputs = node.matches('input[type="number"], input[inputmode="decimal"]')
                        ? [node]
                        : node.querySelectorAll?.('input[type="number"], input[inputmode="decimal"]') || [];
                    newInputs.forEach(applyNumberFormatting);
                }
            });
        });
    });
    observer.observe(document.body, { childList: true, subtree: true });

    // --- On form submit (capture phase, before any handlers) ---
    document.addEventListener("submit", function (e) {
        const form = e.target;
        const inputs = form.querySelectorAll('input[inputmode="decimal"]');
        inputs.forEach(inp => {
            inp.value = cleanValue(inp.value); // remove commas + letters
        });
    }, true); // capture=true ensures it runs first
});

</script>

</body>
</html>
